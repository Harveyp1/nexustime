<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NexusTime App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #111827; color: #E5E7EB; }
        .cta-button { transition: all 0.3s ease; background-color: #34D399; color: #111827; }
        .secondary-button { background-color: transparent; border: 1px solid #34D399; color: #34D399; transition: all 0.3s ease; }
        .danger-button { background-color: transparent; border: 1px solid #F87171; color: #F87171; transition: all 0.3s ease; }
        .card { background-color: #1F2937; border: 1px solid #374151; }
        .header { background-color: rgba(17, 24, 39, 0.8); backdrop-filter: blur(10px); }
        .page { display: none; }
        .page.active { display: block; }
        .form-input, .form-select { background-color: #1F2937; border: 1px solid #374151; color: #E5E7EB; border-radius: 0.5rem; }
        .form-input:focus, .form-select:focus { outline: none; border-color: #34D399; box-shadow: 0 0 0 2px rgba(52, 211, 153, 0.5); }
        .form-select { -webkit-appearance: none; -moz-appearance: none; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='2' stroke='%2334D399'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19.5 8.25l-7.5 7.5-7.5-7.5' /%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 1.5em 1.5em; padding-right: 2.5rem; }
        .modal-overlay { background-color: rgba(17, 24, 39, 0.8); backdrop-filter: blur(4px); }
        .timesheet-table th, .timesheet-table td { text-align: center; padding: 0.75rem 0.5rem; border: 1px solid #374151; white-space: nowrap; }
        .timesheet-table .row-header { text-align: left; padding-left: 1rem; font-weight: 600; background-color: #374151; }
        .day-header { background-color: #374151; }
        .day-header.editable:hover { background-color: #4B5563; cursor: pointer; }
        .locked-day { background-color: #4B5563; color: #9CA3AF; }
        input[type="checkbox"]:disabled + span { color: #6B7280; }
        .tab-button { border-bottom: 2px solid transparent; }
        .tab-button.active { color: #34D399; border-bottom-color: #34D399; }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">
    <!-- Header -->
    <header class="header sticky top-0 z-30">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="index.html">
                <img src="https://raw.githubusercontent.com/Harveyp1/nexustime/main/nexustimelogo.png" alt="NexusTime Logo" class="h-10" onerror="this.onerror=null; this.src='https://placehold.co/160x40/111827/34D399?text=NexusTime';">
            </a>
            <nav id="app-nav" class="hidden items-center space-x-6">
                 <a href="dashboard.html" class="nav-link text-gray-400 hover:text-emerald-400">Dashboard</a>
                 <a href="timesheet.html" class="nav-link text-gray-400 hover:text-emerald-400">Timesheets</a>
                 <a href="manage.html" class="nav-link text-gray-400 hover:text-emerald-400">Manage</a>
                 <a href="settings.html" class="nav-link text-gray-400 hover:text-emerald-400">Settings</a>
                 <a href="workspaces.html" class="nav-link text-gray-400 hover:text-emerald-400">Switch Workspace</a>
                 <button id="logout-button" class="secondary-button px-4 py-2 rounded-lg text-sm font-medium">Log Out</button>
            </nav>
        </div>
    </header>

    <main>
        <div id="login" class="page">
            <section class="py-20"><div class="max-w-md mx-auto card p-8 rounded-xl mt-10"><div class="text-center mb-8"><h3 class="text-3xl font-bold text-white">Welcome Back</h3><p class="text-gray-400 mt-2">Log in to manage your workspaces.</p></div><form id="login-form"><div class="mb-4"><label for="login-email" class="block text-gray-300 mb-2">Email</label><input type="email" id="login-email" class="w-full p-3 form-input" required></div><div class="mb-6"><label for="login-password" class="block text-gray-300 mb-2">Password</label><input type="password" id="login-password" class="w-full p-3 form-input" required></div><p id="login-error" class="text-red-400 text-sm mb-4 text-center hidden"></p><div class="text-center"><button type="submit" class="w-full cta-button px-8 py-3 rounded-lg font-semibold">Log In</button></div><p class="text-center mt-4 text-sm text-gray-400">Don't have an account? <a href="#signup" data-page="signup" class="nav-link text-emerald-400 hover:underline">Sign up</a></p></form></div></section>
        </div>
        <div id="signup" class="page">
             <section class="py-20"><div class="max-w-md mx-auto card p-8 rounded-xl mt-10"><div class="text-center mb-8"><h3 class="text-3xl font-bold text-white">Create Your Account</h3><p class="text-gray-400 mt-2">Start your free trial today.</p></div><form id="signup-form" class="space-y-4"><div class="mb-4"><label for="signup-name" class="block text-gray-300 mb-2">Your Full Name</label><input type="text" id="signup-name" class="w-full p-3 form-input" required></div><div><label for="signup-company-name" class="block text-gray-300 mb-2">Company Name</label><input type="text" id="signup-company-name" class="w-full p-3 form-input" required></div><div><label for="signup-email" class="block text-gray-300 mb-2">Email</label><input type="email" id="signup-email" class="w-full p-3 form-input" required></div><div><label for="signup-password" class="block text-gray-300 mb-2">Password</label><input type="password" id="signup-password" class="w-full p-3 form-input" placeholder="At least 6 characters" required></div><p id="signup-error" class="text-red-400 text-sm text-center hidden"></p><div class="pt-2"><button type="submit" class="w-full cta-button px-8 py-3 rounded-lg font-semibold">Sign Up</button></div><p class="text-center pt-2 text-sm text-gray-400">Already have an account? <a href="#login" data-page="login" class="nav-link text-emerald-400 hover:underline">Log in</a></p></form></div></section>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, addDoc, collection, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { stateManager } from './common.js';

        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        const pages = document.querySelectorAll('.page');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const loginError = document.getElementById('login-error');
        const signupError = document.getElementById('signup-error');
        const appNav = document.getElementById('app-nav');

        const showPage = (pageId) => {
            pages.forEach(page => page.classList.remove('active'));
            const targetPage = document.getElementById(pageId);
            if (targetPage) targetPage.classList.add('active');
        };
        
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                const pageId = e.currentTarget.dataset.page;
                if(pageId) { e.preventDefault(); history.pushState({ page: pageId }, '', `#${pageId}`); showPage(pageId); }
            })
        });

        onAuthStateChanged(auth, user => {
            if (user) {
                window.location.href = 'workspaces.html';
            } else {
                if (appNav) appNav.style.display = 'none';
                const pageId = window.location.hash.substring(1) || 'login';
                showPage(pageId);
            }
        });

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = loginForm['login-email'].value;
            const password = loginForm['login-password'].value;
            loginError.textContent = '';
            loginError.classList.add('hidden');
            try {
                await signInWithEmailAndPassword(auth, email, password);
                localStorage.setItem('isLoggedIn', 'true');
                // onAuthStateChanged will redirect
            } catch (error) {
                loginError.textContent = error.message;
                loginError.classList.remove('hidden');
            }
        });

        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = signupForm['signup-name'].value;
            const companyName = signupForm['signup-company-name'].value;
            const email = signupForm['signup-email'].value;
            const password = signupForm['signup-password'].value;
            signupError.textContent = '';
            signupError.classList.add('hidden');
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                await setDoc(doc(db, "users", user.uid), { name, email, createdAt: serverTimestamp() });
                const workspaceRef = await addDoc(collection(db, "workspaces"), { name: companyName, ownerId: user.uid, plan: "Free", createdAt: serverTimestamp() });
                await addDoc(collection(db, `workspaces/${workspaceRef.id}/employees`), { userId: user.uid, name, status: 'Active', hireDate: new Date().toISOString().split('T')[0] });
                localStorage.setItem('isLoggedIn', 'true');
                // onAuthStateChanged will redirect
            } catch (error) {
                signupError.textContent = error.message;
                signupError.classList.remove('hidden');
            }
        });

        const initialPage = window.location.hash.substring(1) || 'login';
        showPage(initialPage);
    </script>
</body>
</html>
